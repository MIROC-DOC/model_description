<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>MIROC-DOC p-sfc</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="github-markdown.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->

<link rel="stylesheet" href="github.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    menuSettings: {locale: "ja"},
    extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
    TeX: {
      extensions: ["AMSmath.js", "AMSsymbols.js", "noErrors.js", "noUndefined.js"],
      noErrors: {disabled: true},
      noUndefined: {disabled: true}
    },
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [["$","$"] ],
      displayMath: [["$$","$$"]],
      processEscapes: true
    }
  });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">MIROC-DOC p-sfc</h1>
</header>
<h2 id="surface-processes.">Surface Processes.</h2>
<h3 id="overview-of-surface-processes.">Overview of Surface Processes.</h3>
<p>The surface processes are the processes of momentum, heat, and water between the atmosphere and the earth’s surface Giving boundary conditions at the lower end of the atmosphere through flux exchange. Surface processes are described in the Ground Temperature <span class="math inline"><em>T</em><sub><em>g</em></sub></span>, Ground Moisture <span class="math inline"><em>W</em><sub><em>g</em></sub></span>, Handle your own forecast variables, such as snow cover <span class="math inline"><em>W</em><sub><em>y</em></sub></span>, Thermal inertia of the ground surface, water accumulation, snow accumulation, Evaluate the accumulation of sea ice and other factors. The main input data are the diffusion of geophysical quantities between the atmosphere and the surface and the fluxes due to radiation and precipitation. The output data are the surface temperature (<span class="math inline"><em>T</em><sub><em>s</em></sub></span>) and Various boundary condition parameters such as albedo and roughness.</p>
<p>Surface processes are classified as follows.</p>
<ol type="1">
<li><p>geothermal diffusion processes - Determining the geothermal structure</p></li>
<li><p>geological and hydrological processes - Determining the structure of underground water, runoff, etc.</p></li>
<li><p>snow accumulation process - snow accumulation, snowmelt, etc., expression of snow-related processes</p></li>
<li><p>oceanic mixed layer processes - determining ocean temperature and sea ice thickness (optional)</p></li>
</ol>
<p>We briefly list the characteristics of the CCSR/NIES AGCM surface processes:</p>
<p>Evaluate the thermal conductivity and water diffusion (optional) of multiple layers in the ground.</p>
<ol start="2" type="1">
<li><p>assessing the surface heat balance using the surface temperature.</p></li>
<li><p>diffusional conduction of heat and water is solved by the implicit method.</p></li>
</ol>
<p>Snow is not treated as a separate layer, but is evaluated together with the first surface layer.</p>
<ol start="5" type="1">
<li>assessing oceanic mixed layers and sea ice in multiple layers (optional)</li>
</ol>
<p>The scheme is outlined in detail along the calculation flow. the part in the square brackets is the name of the corresponding subroutine and the part in ( ) is the file name. The entries enclosed in parentheses refer to the descriptions in other sections.</p>
<ol type="1">
<li><p>(Evaluate surface fluxes <code>MODULE:[SFCFLX(psfcm)]</code>) The heat, water (evaporation), and momentum fluxes between the atmosphere and the surface are Estimate in bulk. However, the evaporation efficiency (<span class="math inline"><em>β</em></span>) is set to 1.</p></li>
<li><p>evaluate the surface roughness <code>MODULE:[GNDZ0(pgsfc)]</code> Basically, it depends on the file and the surface type. I can get it from the outside, Change according to snowfall and other factors.</p></li>
<li><p>evaluate the heat flux and heat capacity within the ground surface . <code>MODULE:[LNDFLX(pglnd), SEAFLX(pgsea), SNWFLX (pgsnw)]</code> Estimate the heat capacity of each layer of land and sea, The heat flux at each layer boundary is estimated from the heat transfer equation. If there is snowfall, change the heat capacity and flux.</p></li>
<li><p>evaluate the water flux and capacity of the land surface <code>MODULE:[LNDWFX(pglnd)]</code> Estimate the capacity of each layer of water on land, Estimate the water flux at each layer boundary from the water diffusion equation</p></li>
<li><p>evaluate the evaporation efficiency <code>MODULE:[GNDBET(pgsfc)]</code> For the land surface, the calculation depends on soil moisture and stomatal resistance.</p></li>
<li><p>perform an implicit solution of geothermal conduction up to the middle <code>MODULE:[GNDHT1( pggnd)]</code> Evaluate the temperature change due to heat conduction in the ground. However, taking into account the surface temperature changes Since it is done implicitly, only the first step is done here.</p></li>
<li><p>solving the surface heat balance <code>MODULE:[SLVSFC(pgslv)]</code> Solving the equation for the heat balance between the surface temperature and Time variation of temperature and specific humidity in the first layer of the atmosphere. Using this, the heat/water (evaporation) flux between the atmosphere and the ground surface and compensate for the heat transfer flux at the surface. If there is snow or ice and the surface temperature is above the freezing point, With the surface temperature as the freezing point, Evaluate the residual flux as the flux used for snowmelt.</p></li>
<li><p>implicit solution for geothermal conduction <code>MODULE:[GNDHT2(pggnd )]</code> Since the change in surface temperature was obtained, we used it to determine Solving for changes in ground temperature due to heat conduction in the ground.</p></li>
<li><p>evaluate snow reduction by snow sublimation <code>MODULE:[SNWSUB(pgsnw)]</code> For snow cover conditions, the calculated evaporation (sublimation) fluxes allow Decrease the snowpack.</p></li>
<li><p>assessing the increase in snow cover due to snowfall <code>MODULE:[SNWFLP(pgsnw)]</code> It discriminates between snowfall and rainfall and increases the snowpack when it falls.</p></li>
<li><p>assessing snowfall reduction due to snowmelt <code>MODULE:[SNWMLP(pgsnw)]</code> If the surface temperature or first layer temperature exceeds the freezing point during snowfall , If the snow melts, it will keep the temperature below the freezing point, Decrease the snowpack.</p></li>
<li><p>solves the diffusion of groundwater by implicit method <code>MODULE:[GNDWTR( pggnd)]</code> Solving changes in subsurface moisture due to subsurface water fluxes.</p></li>
<li><p>evaluate precipitation interception by snowpack <code>MODULE:[SNWROF(pgsnw)]</code> Snowfall prevents precipitation infiltration into the soil, Rainfall and snowmelt water (part of it) will be runoff.</p></li>
<li><p>assessing surface runoff <code>MODULE:[LNDROF(pglnd)]</code> Calculating surface runoff of rainfall and snowmelt water. Bucket Model, New Bucket Model, There are 3 evaluation methods to choose from, including runoff evaluation using permeability.</p></li>
<li><p>evaluate the freezing process <code>MODULE:[LNDFRZ(pglnd)]</code> Freezing and thawing of groundwater and Calculate the temperature change due to the latent heat release associated with it. However, this routine is optional, Usually skipped.</p></li>
<li><p>assessing the growth of sea ice <code>MODULE:[SEAICE(pgsea)]</code> If you specify the marine mixed layer option , Calculate the increase or decrease in the thickness of the sea ice due to heat conduction.</p></li>
<li><p>evaluate the melting of sea ice surface <code>MODULE:[SEAMLT(pgsea)]</code> If the surface temperature or first layer temperature of the sea ice exceeds the freezing point, The temperature is kept below the freezing point, Decrease the thickness of the sea ice.</p></li>
<li><p>nudge the ocean temperature <code>MODULE:[SEANDG(pgsea)]</code> With the oceanic mixed layer option, the given Nudging to get closer to the temperature. It can be added to the temperature of the sea surface.</p></li>
<li><p>evaluate the wind speed on the ground <code>MODULE:[SLVWND(pggnd)]</code> Solving for changes in wind speed in the first layer of the atmosphere.</p></li>
</ol>
<p>Also, some of the routines mentioned above are In addition, the following subroutines for the evaluation of land, sea and snow surfaces are used There’s a split.</p>
<ol type="1">
<li><p>setting the boundary conditions <code>MODULE:[GNDSFC(pgbnd)]</code></p>
<ol type="1">
<li><p>read the surface conditions <code>MODULE:[GETIDX(pgbnd)]</code></p></li>
<li><p>read the sea level condition <code>MODULE:[GETSEA(pgbnd)]</code></p></li>
<li><p>set the condition of sea level <code>MODULE:[SEATMP(pgsea)]</code></p></li>
</ol></li>
<li><p>evaluate the surface albedo <code>MODULE:[GNDALB(pgsfc)]</code></p>
<ol type="1">
<li><p>load the albedo <code>MODULE:[GETALB(pgbnd)]</code></p></li>
<li><p>change the land surface albedo <code>MODULE:[LNDALB(pglnd)]</code></p></li>
<li><p>change the sea-surface albedo <code>MODULE:[SEAALB(pgsea)]</code></p></li>
<li><p>change the snow albedo <code>MODULE:[SNWALB(pgsnw)]</code></p></li>
</ol></li>
<li><p>evaluate the surface roughness <code>MODULE:[GNDZ0(pgsfc)]</code></p>
<ol type="1">
<li><p>read the roughness <code>MODULE:[GETZ0(pgbnd)]</code></p></li>
<li><p>change the land surface roughness <code>MODULE:[LNDZ0(pglnd)]</code></p></li>
<li><p>change the sea surface roughness <code>MODULE:[SEAZ0(pgsea)]</code></p></li>
<li><p>change the snow surface roughness <code>MODULE:[SNWZ0(pgsnw)]</code></p></li>
</ol></li>
<li><p>evaluate the surface wetness <code>MODULE:[GNDBET(pgsfc)]</code></p>
<ol type="1">
<li><p>read the degree of wetness <code>MODULE:[GETBET(pgbnd)]</code></p></li>
<li><p>change the surface wetness <code>MODULE:[LNDBET(pglnd)]</code></p></li>
<li><p>change the degree of sea surface wetness <code>MODULE:[SEABET(pgsea)]</code></p></li>
<li><p>change the snow surface wetness <code>MODULE:[SNWBET(pgsnw)]</code></p></li>
</ol></li>
</ol>
<h3 id="classification-of-the-ground-surface.">classification of the ground surface.</h3>
<p>The ground surface is a condition given by the outside world, According to the surface type <span class="math inline"><em>m</em></span>, they are classified as follows.</p>
<ul>
<li><p>TAB00000:0.0 m</p></li>
<li><p>TAB00000:0.1 requirement</p></li>
<li><p>TAB00000:1.0 -I can’t even begin to tell you what to do.</p></li>
<li><p>TAB00000:1.1 mixed-layered ocean</p></li>
<li><p>TAB00000:2.0 -I can’t tell you how many times I’ve been in a row.</p></li>
<li><p>TAB00000:2.1 Sea Ice (given from outside)</p></li>
<li><p>TAB00000:3.0 0</p></li>
<li><p>TAB00000:3.1 Sea level (providing temperature from outside)</p></li>
<li><p>TAB00000:4.0 1</p></li>
<li><p>TAB00000:4.1 land ice</p></li>
<li><p>TAB00000:5.0 <span class="math inline">≥</span> 2</p></li>
<li><p>TAB00000:5.1 land surface</p></li>
</ul>
<p>Furthermore, depending on the possible internal changes in the ice conditions, Take the following ground surface conditions <span class="math inline"><em>n</em></span>.</p>
<ul>
<li><p>TAB00001:0.0 n</p></li>
<li><p>TAB00001:0.1 state</p></li>
<li><p>TAB00001:1.0 0</p></li>
<li><p>TAB00001:1.1 Sea surface without ice</p></li>
<li><p>TAB00001:2.0 1</p></li>
<li><p>TAB00001:2.1 Sea Ice and Land Ice</p></li>
<li><p>TAB00001:3.0 <span class="math inline">≥</span> 2</p></li>
<li><p>TAB00001:3.1 land surface</p></li>
</ul>
<p>These are defined in <code>MODULE:[GNDSFC(pgsfc)]</code>.</p>
<h3 id="surface-heat-balance.">Surface Heat Balance.</h3>
<p>The conditions of the surface heat balance are ,</p>
<p><br /><span class="math display"><em>F</em><em>θ</em>(<em>T</em><sub>0</sub>, <em>T</em><sub>1</sub>) + <em>L</em><em>β</em><em>F</em><em>q</em><sup><em>P</em></sup>(<em>T</em><sub>0</sub>, <em>q</em><sub>1</sub>) + <em>F</em><em>R</em>(<em>T</em><sub>0</sub>) − <em>F</em><em>g</em>(<em>T</em><sub>0</sub>, <em>G</em><sub>1</sub>) = 0</span><br /></p>
<blockquote>
<p><span id="p-sfc:sfc-balance" label="p- sfc:sfc-balance">[p-sfc:sfc-balance[p-sfc:sfc-balance]&amp; lt;/span&gt;</p>
</blockquote>
<p>It is. <span class="math inline"><em>F</em><em>θ</em>, <em>F</em><em>q</em><sup><em>P</em></sup>, <em>F</em><em>R</em>, <em>F</em><em>g</em></span>, <span class="math inline"><em>F</em><em>θ</em>, <em>F</em><em>q</em><sup><em>P</em></sup>, <em>F</em><em>R</em>, <em>F</em><em>g</em></span> is , Atmospheric and subsurface forecast variables before evaluating surface processes and , The evaluation is performed using the In the <span class="math inline"><em>T</em><sub>0</sub></span> used at that time, this balance is generally not met.</p>
<p>There are several ways to solve this problem.</p>
<ol type="1">
<li><p>how to consider only <span class="math inline"><em>T</em><sub>0</sub></span> as an unknown</p></li>
<li><p>how to consider <span class="math inline"><em>T</em><sub>0</sub>, <em>T</em><sub>1</sub>, <em>q</em><sub>1</sub>, <em>G</em><sub>1</sub></span> as unknown numbers</p></li>
</ol>
<p>The CCSR/NIES AGCM uses the latter method. In doing so, it is necessary to combine and solve for all the variables of the atmospheric and ground layers. The details are described in the section “Solving the Diffusion-Based Budget Equations for Atmospheric Surface Systems”.</p>
<p>There are two ways to evaluate the evaporation terms <span class="math inline"><em>β</em><em>F</em><em>q</em><sup><em>P</em></sup>(<em>T</em><sub>0</sub>, <em>q</em><sub>1</sub>)</span>.</p>
<ol type="1">
<li><p>as a <span class="math inline"><em>β</em> = 1</span> ([p-sfc:sfc-balance]](#p-sfc:sfc-balance <span class="math inline"><em>F</em><em>q</em><sup><em>P</em></sup></span>, obtained by solving for (1) (possible evaporation amount) multiplied by <span class="math inline"><em>β</em></span>.</p></li>
<li><p>using <span class="math inline"><em>β</em></span>. (<a href="#p-sfc:sfc-balance">p-sfc:sfc-balance]</a>) directly.</p></li>
</ol>
<p>The temperatures used in the calculations in <span class="math inline"><em>β</em><em>F</em><em>q</em><sup><em>P</em></sup></span> are different between the former and the latter. In the former case, the temperature in the case of <span class="math inline"><em>β</em> = 1</span>, In the latter case, the actual temperature is used.</p>
<p>The CCSR/NIES AGCM uses the former method as standard. On a snow or ice surface ([p-sfc<a href="#p-sfc:%20sfc-balance">p-sfc:sfc-balance]</a>) of the result of solving If the <span class="math inline"><em>T</em><sub>0</sub></span> exceeds the freezing point, Or, when <span class="math inline"><em>T</em><sub>0</sub></span> divides the freezing temperature of seawater at the sea surface (in the case of oceanic mixed-layer model) by fixing the temperature of the <span class="math inline"><em>T</em><sub>0</sub></span> at the freezing point and calculating each flux, (<a href="#p-sfc:sfc-balance">p-sfc:sfc-balance]</a>), and the residuals (energy residuals) of the formula Suppose it is used for freezing and thawing snow and ice.</p>
<h3 id="set-the-discrete-coordinate-system-modulesetglvsetwlvsetslv">Set the discrete coordinate system <code>MODULE:[SETGLV,SETWLV,SETSLV]</code></h3>
<p>The ground is discretized with the <span class="math inline"><em>z</em></span> coordinate system. Land temperature is layer <span class="math inline"><em>z</em><em>g</em><sub><em>l</em></sub></span>, water content is layer <span class="math inline"><em>z</em><em>w</em><sub><em>l</em></sub></span>, Ocean temperature is defined in layer <span class="math inline"><em>z</em><em>s</em><sub><em>l</em></sub></span>. The <span class="math inline"><em>l</em></span> increases from the top to the bottom. The flux is defined by the layer boundary <span class="math inline"><em>z</em><em>g</em><sub><em>k</em> − 1/2</sub>, <em>z</em><em>w</em><sub><em>k</em> − 1/2</sub></span>.</p>
<p>Also, consider a layer of zero thickness on the <span class="math inline"><em>z</em> = 0</span>, Define skin temperature <span class="math inline"><em>T</em><sub><em>s</em></sub></span>. For convenience, it is represented by <span class="math inline"><em>l</em> = 0</span> and <span class="math inline"><em>z</em><em>g</em><sub>0</sub> = <em>z</em><em>g</em><sub>1/2</sub> = <em>z</em><em>g</em><sub> − 1/2</sub> = 0</span>.</p>
<h3 id="calculating-land-heat-flux-and-heat-capacity-modulelndflx">Calculating land heat flux and heat capacity <code>MODULE:[LNDFLX]</code></h3>
<p>Physical quantities, such as heat and moisture fluxes in the ground, and wetness The evaluation of surface characteristics is based on whether the surface is sea or land, and in the case of land surface This is done separately if there is snowfall or not. In the following section, we will first evaluate the evaluation method for the land surface case without snow. We shall describe in brief. We will describe the difference between the case of sea level and snow surface in detail later.</p>
<p>The heat capacity of the land surface is ,</p>
<p><br /><span class="math display"><em>C</em><em>g</em><sub><em>l</em></sub> = <em>C̃</em><em>g</em><sub><em>l</em></sub>(<em>z</em><em>g</em><sub><em>l</em> + 1/2</sub> − <em>z</em><em>g</em><sub><em>l</em> − 1/2</sub>) = <em>C̃</em><em>g</em><sub><em>l</em></sub><em>Δ</em><em>z</em><em>g</em><sub><em>l</em></sub> .</span><br /></p>
<p>where <span class="math inline"><em>C̃</em><em>g</em><sub><em>l</em></sub></span> is the volume specific heat.</p>
<p>The heat flux of the land surface is treated as a constant heat conduction coefficient (which may depend on <span class="math inline"><em>l</em></span>). ).</p>
<p><br /><span class="math display"><em>F</em><em>g</em><sub><em>l</em> − 1/2</sub> = <em>K</em><em>g</em><sub><em>l</em> − 1/2</sub>(<em>G</em><sub><em>l</em></sub> − <em>G</em><sub><em>l</em> − 1</sub>)(<em>z</em><em>g</em><sub><em>l</em></sub> − <em>z</em><em>g</em><sub><em>l</em> − 1</sub>) ,</span><br /></p>
<p><br /><span class="math display">$$
  \frac{\partial Fg_{l-1/2}}{\partial G_l} = - \frac{\partial Fg_{l-1/2}}{\partial G_{l-1}}
 = Kg_{l-1/2}/(zg_l - zg_{l-1}) \; .
$$</span><br /></p>
<h3 id="calculating-the-water-flux-on-land-modulelndwfx">Calculating the water flux on land <code>MODULE:[LNDWFX]</code></h3>
<p>The capacity of water in each layer <span class="math inline"><em>C</em><sub><em>w</em></sub></span> is ,</p>
<p><br /><span class="math display"><em>C</em><em>w</em><sub><em>l</em></sub> = <em>ρ</em><sub><em>w</em></sub>(<em>z</em><em>w</em><sub><em>l</em> + 1/2</sub> − <em>z</em><em>w</em><sub><em>l</em> − 1/2</sub>) = <em>ρ</em><sub><em>w</em></sub><em>Δ</em><em>z</em><em>w</em><sub><em>l</em></sub> .</span><br /></p>
<p>However, in practice, it is not possible to store this much water. The maximum storage capacity, i.e., the saturation capacity, is defined as the saturation water content of <span class="math inline"><em>w</em><em>s</em></span>,</p>
<p><br /><span class="math display"><em>C</em><em>w</em><em>s</em><sub><em>l</em></sub> = <em>w</em><em>s</em><sub><em>l</em></sub><em>ρ</em><sub><em>w</em></sub>(<em>z</em><em>w</em><sub><em>l</em> + 1/2</sub> − <em>z</em><em>w</em><sub><em>l</em> − 1/2</sub>) = <em>w</em><em>s</em><sub><em>l</em></sub><em>ρ</em><sub><em>w</em></sub><em>Δ</em><em>z</em><em>w</em><sub><em>l</em></sub> .</span><br /></p>
<p>The basic formula for the groundwater flux can be written as follows.</p>
<p><br /><span class="math display">$$
  F{w} = - K_{w} \left( \frac{\partial w}{\partial z} + g_w \right)
$$</span><br /></p>
<blockquote>
<p>&lt;span id=“basic-Fw” label=“basic-Fw”&amp; gt;gt;\braham[basic-Fw]&lt; /span&gt;</p>
</blockquote>
<p>Here, <span class="math inline"><em>g</em><sub><em>w</em></sub></span> represents the effect of gravity.</p>
<p>There are two ways to evaluate the groundwater flux on land.</p>
<ol type="1">
<li><p>fixed diffusion coefficient method</p></li>
<li><p>moisture content dependent diffusion coefficient method <code>MODULE:[HYDFLX]</code></p></li>
</ol>
<p>In the method of fixed diffusion coefficients, we simply express it as follows. <span class="math inline"><em>K</em><sub><em>w</em></sub></span> is the diffusion coefficient and <span class="math inline"><em>ρ</em><sub><em>w</em></sub></span> is the density of liquid water. where the gravitational potential in (<a href="#basic-Fw">basic-Fw]</a>) The term <span class="math inline"><em>g</em><sub><em>w</em></sub></span> is Ignore it.</p>
<p><br /><span class="math display"><em>F</em><em>w</em><sub><em>l</em> − 1/2</sub> = <em>ρ</em><sub><em>w</em></sub><em>K</em><em>w</em><sub><em>l</em> − 1/2</sub>(<em>w</em><sub><em>l</em></sub> − <em>w</em><sub><em>l</em> − 1</sub>)/(<em>z</em><em>w</em><sub><em>l</em></sub> − <em>z</em><em>w</em><sub><em>l</em> − 1</sub>) ,</span><br /></p>
<p><br /><span class="math display">$$
  \frac{\partial Fw_{l-1/2}}{\partial w_l} = - \frac{\partial Fw_{l-1/2}}{\partial w_{l-1}}
 = \rho_w Kw_{l-1/2}/(zw_l - zw_{l-1}) \; .
$$</span><br /></p>
<p>On the other hand, the method with the moisture content dependent diffusion coefficient is not applicable, Using the hydraulic potential, we obtain the following.</p>
<p><br /><span class="math display"><em>F</em><em>w</em><sub><em>l</em> − 1/2</sub> = <em>ρ</em><sub><em>w</em></sub><em>K</em><em>w</em><sub><em>l</em> − 1/2</sub>(<em>W</em><sub><em>l</em> − 1/2</sub>)<sup>2<em>B</em> + 3</sup>((<em>ψ</em><sub><em>l</em></sub> − <em>ψ</em><sub><em>l</em> − 1</sub>)/(<em>z</em><em>w</em><sub><em>l</em></sub> − <em>z</em><em>w</em><sub><em>l</em> − 1</sub>) − 1) ,</span><br /></p>
<p><br /><span class="math display">$$
  \frac{\partial Fw_{l-1/2}}{\partial w_l} = \rho_w Kw_{l-1/2} (W_{l-1/2})^{2B+3} 
                     \frac{\partial \psi_{l}}{\partial w_l}/(zw_l - zw_{l-1}) \; ,\\
- \frac{\partial Fw_{l-1/2}}{\partial w_{l-1}} = \rho_w Kw_{l-1/2} (W_{l-1/2})^{2B+3} 
                     \frac{\partial \psi_{l-1}}{\partial w_{l-1}}/(zw_l - zw_{l-1}) \; .
$$</span><br /></p>
<p>where <span class="math inline"><em>K</em><em>w</em></span> is the saturated hydraulic conductivity, <span class="math inline"><em>W</em></span> is the saturation degree, <span class="math inline"><em>ψ</em></span> is the pressure potential, It is given as follows.</p>
<p><br /><span class="math display"><em>W</em><sub><em>l</em></sub> = <em>w</em><sub><em>l</em></sub>/<em>w</em><em>s</em><sub><em>l</em></sub> ,  <em>W</em><sub><em>l</em> − 1/2</sub> = (<em>W</em><sub><em>l</em> − 1</sub> + <em>W</em><sub><em>l</em></sub>)/(<em>C</em><em>w</em><sub><em>l</em> − 1</sub> + <em>C</em><em>w</em><sub><em>l</em></sub>) ,</span><br /></p>
<p><br /><span class="math display">$$
  \psi_l = \psi s_l (W_l)^{-B}\; , \;\;
  \frac{\partial \psi_l}{\partial w_l} = -B \psi_l W_l / ws \; .
$$</span><br /></p>
<p><span class="math inline"><em>K</em><em>w</em></span>, <span class="math inline"><em>B</em></span>, and <span class="math inline"><em>ψ</em><em>s</em></span> are constants, surface type May depend on <span class="math inline"><em>m</em></span> and <span class="math inline"><em>l</em></span>.</p>
<h3 id="calculating-land-surface-spillmodulelndrof">Calculating land surface spill<code>MODULE:[LNDROF]</code></h3>
<p>The following three methods can be used to evaluate runoff.</p>
<ol type="1">
<li><p>bucket model</p></li>
<li><p>new bucket model</p></li>
<li><p>surface runoff with consideration of infiltration capacity</p></li>
</ol>
<p>In the bucket model ,</p>
<p><br /><span class="math display">$$
w_1^{m+1,*} = w_1^{m+1} +  \frac{P - E}{Cw_1} \Delta t
$$</span><br /></p>
<p>and this is</p>
<p><br /><span class="math display"><em>w</em><sub>1</sub><sup><em>m</em> + 1, *</sup> &gt; <em>w</em><sub><em>s</em></sub></span><br /></p>
<p>with the outflow as <span class="math inline"><em>R</em><sub><em>B</em></sub></span>,</p>
<p><br /><span class="math display">$$
  w_1^{m+1}  =  w_s \\
  R_B   =   Cw_1 ( w_1^{m+1,*} - w_s )/\delta t
$$</span><br /></p>
<p>. Other than that ,</p>
<p><br /><span class="math display">$$
  w_1^{m+1}  =   w_1^{m+1,*} \\
  R_B        =   0                  \; .
$$</span><br /></p>
<p>The new bucket model (Kondo, 1993) is based on the idea that surface soil types and depths are spatially It is a model for estimating the average groundwater infiltration rate for non-uniform cases. It was originally developed to estimate the daily average outflow of , Here, we changed it to be used at each time step. In the new bucket model, precipitation infiltration and post-runoff soil moisture are estimated as follows.</p>
<p><br /><span class="math display">$$
w_1^{m+1} = w_1^m + ( ws_1 - w_1^m ) 
\tanh\left( \frac{(P-E)\tau_B}{Cw_1(ws_1 - w_1^m)} \right) 
\Delta t / \tau_B \; .
$$</span><br /></p>
<p>Here, <span class="math inline"><em>τ</em><sub><em>B</em></sub></span> is a time constant (standard value 3600s). In this case, the runoff volume (<span class="math inline"><em>R</em><sub><em>N</em></sub></span>) is calculated from the surface water balance</p>
<p><br /><span class="math display">$$
     R_N  =  P - E - Cw_1 ( w_1^{m+1} - w_1^m ) / \Delta t \\
          =  (P - E) \left( 1 - \frac{\tanh x}{x} \right)
$$</span><br /></p>
<p>It is estimated that . However,</p>
<p><br /><span class="math display">$$
  x = \frac{(P-E)\tau_B}{Cw_1(ws_1 - w_1^m)} \; .
$$</span><br /></p>
<p>The evaluation of the surface runoff <span class="math inline"><em>R</em><sub><em>I</em></sub></span> considering soil infiltration capacity is based on the evaluation of the infiltration capacity of the <span class="math inline"><em>C</em><sub><em>I</em></sub></span>, Assuming that the intensity of stratiform rainfall is <span class="math inline"><em>P</em><sub><em>l</em></sub></span> and that of convective rainfall is <span class="math inline"><em>P</em><sub><em>c</em></sub></span>, Given below.</p>
<p><br /><span class="math display">$$
  R_I = \left\{
    \begin{array}{ll}
       P_c \exp [ -(C_I-P_l) / (P_c/\kappa) ]  \;\; ( P_l \le C_I ) \\
       P_l + P_c - C_I                         \;\; ( P_l &gt; C_I ) 
    \end{array}
  \right. \; .
$$</span><br /></p>
<blockquote>
<p>&lt;span id=“inf-exs” label=“inf-exs”&amp;gt ;inf-exs]&lt; /span&gt;</p>
</blockquote>
<p>The amount of precipitation input percolating to the ground surface is modified as follows.</p>
<p><br /><span class="math display">$$
  \widetilde{P_c} = \left\{
    \begin{array}{ll}
      P_c - R_I  \;\; ( P_l \le C_I ) \\
      0             \;\; ( P_l &gt; C_I )
    \end{array}
  \right. \; , \\
  \widetilde{P_l} = \left\{
    \begin{array}{ll}
      P_l   \;\; ( P_l \le C_I ) \\
      C_I  \;\; ( P_l &gt; C_I )
    \end{array}
  \right. \; .
$$</span><br /></p>
<p>On the formula ([index<a href="#inf-exs">inf-exs]</a>), convective rainfall intensity To probability <span class="math inline"><em>f</em>(<em>P</em><sub><em>c</em></sub>)</span> It is derived from the following equation, which assumes an exponential distribution.</p>
<p><br /><span class="math display">$$
  f(P_c) = \frac{\kappa}{\overline{P_c}} 
            \exp\left[-\frac{\kappa}{\overline{P_c}}P_c\right] \; ,
$$</span><br /></p>
<p><br /><span class="math display">$$
  \frac{R_I}{\kappa} = \int_{\widetilde{C_I}}^{\infty}
                        (P_c-\widetilde{C_I})f(P_c) d(P_c) \; .
$$</span><br /></p>
<p>However, assuming that stratocumulus rainfall is uniformly infiltrating, the effective infiltration capacity of <span class="math inline">$\widetilde{C_I} = C_I - P_l$</span>. <span class="math inline"><em>κ</em></span> is the percentage of convective rainfall area in the total grid area, It is a constant (0.6 by default).</p>
<p>When considering multi-layered soil moisture transfer, We can also consider the drainage from each layer proportional to the permeability coefficient.</p>
<h3 id="evaluating-albedo-on-land-modulelndalb">Evaluating Albedo on land <code>MODULE:[LNDALB]</code></h3>
<p>The evaluation of albedo is basically based on a constant value given by an external source. There are two ways to give it.</p>
<ol type="1">
<li><p>give a distribution in a file</p></li>
<li><p>specify a value for each surface type <span class="math inline"><em>m</em></span></p></li>
</ol>
<p>For each wavelength band, we can give two components in the visible and near-infrared (The same values are used in the standard).</p>
<p>We can also consider the effects of surface wetness and solar radiation zenith angle as follows (Not considered in the standard).</p>
<p><br /><span class="math display"><em>α</em> = <em>α</em> − <em>f</em><sub><em>w</em></sub><em>α</em><em>w</em><sub>1</sub> ,</span><br /></p>
<p><br /><span class="math display"><em>α</em> = <em>α</em> + <em>Δ</em><em>f</em><sub><em>ζ</em></sub>(1 − <em>α</em>)(1 − cos<sup>2</sup><em>ζ</em>) .</span><br /></p>
<p>where the wetness factor (<span class="math inline"><em>f</em><sub><em>w</em></sub></span>) and the zenith angle factor (<span class="math inline"><em>f</em><sub><em>ζ</em></sub></span>) are constants Yes.</p>
<h3 id="evaluating-roughness-on-land-surfacemodulelndz0">Evaluating roughness on land surface<code>MODULE:[LNDZ0]</code></h3>
<p>The evaluation of roughness is basically based on a constant value given by an external source. There are two ways to give it.</p>
<ol type="1">
<li><p>give a distribution in a file</p></li>
<li><p>specify a value for each surface type <span class="math inline"><em>m</em></span></p></li>
</ol>
<p>The roughness <span class="math inline"><em>z</em><sub>0<em>H</em></sub></span> for heat and the roughness <span class="math inline"><em>z</em><sub>0<em>E</em></sub></span> for water vapor are If not given, the roughness to momentum is a constant multiple of <span class="math inline"><em>z</em><sub>0<em>M</em></sub></span>. (<span class="math inline"><em>z</em><sub>0<em>H</em></sub> = <em>z</em><sub>0<em>E</em></sub> = 0.1<em>z</em><sub>0<em>M</em></sub></span> by default)</p>
<h3 id="evaluating-surface-wetness-on-landmodulelndbet">Evaluating surface wetness on land<code>MODULE:[LNDBET]</code></h3>
<p>On land ice, <span class="math inline"><em>β</em></span> has a constant value of 1. For non-icy land surfaces, we can use several evaluation methods as follows.</p>
<ol type="1">
<li><p>using an externally given constant value. As a way of giving ,</p>
<ol type="1">
<li><p>give a distribution in a file</p></li>
<li><p>specify a value for each surface type <span class="math inline"><em>m</em></span></p></li>
</ol></li>
</ol>
<p>There are two possibilities.</p>
<ol start="2" type="1">
<li>soil moisture calculated as a function of <span class="math inline"><em>w</em></span>.</li>
</ol>
<p>Define the saturation degree <span class="math inline"><em>W</em> ≡ <em>w</em>/<em>w</em><sub><em>s</em></sub></span>, We give it as a function.</p>
<pre><code> Function type 1.</code></pre>
<p>The critical saturation is 1 if it exceeds the critical saturation value of <span class="math inline"><em>W</em><sub><em>c</em></sub></span>, and is linearly dependent below it.</p>
<p><br /><span class="math display"><em>β</em> = min (<em>W</em>/<em>W</em><sub><em>c</em></sub>,1)</span><br /></p>
<pre><code> 2. that depend nonlinearly on function type 2. $W$.</code></pre>
<p><br /><span class="math display"><em>β</em> = 1 − exp [−3(<em>W</em>/<em>W</em><sub><em>c</em></sub>)<sup><em>a</em></sup>]</span><br /></p>
<p>In the following, we describe the different treatment of the sea surface from that of the land surface.</p>
<h3 id="calculating-heat-flux-and-heat-capacity-at-sea-level-moduleseaflx">Calculating heat flux and heat capacity at sea level <code>MODULE:[SEAFLX]</code></h3>
<p>At the sea surface, the heat capacity varies depending on the presence of sea ice. Volumetric Specific Heat of Seawater <span class="math inline"><em>C̃</em><sub><em>s</em></sub></span> and Using the volume specific heat of sea ice with <span class="math inline"><em>C̃</em><sub><em>i</em></sub></span>, <span class="math inline"><em>h</em><sub><em>i</em></sub></span> is used as the thickness of the sea ice,</p>
<p><br /><span class="math display">$$
  Cg_{l}  = \left\{ 
    \begin{array}{ll}
      \tilde{C}_s (zg_{l+1/2} - zg_{l-1/2})
               ( h_i \le zg_{l-1/2} )\\
      \tilde{C}_s (zg_{l+1/2} - h_i)
    + \tilde{C}_i ( h_i - zg_{l-1/2} )
               ( zg_{l-1/2} &lt; h_i &lt; zg_{l+1/2} )\\
      \tilde{C}_i (zg_{l+1/2} - zg_{l-1/2})
               ( h_i \ge zg_{l+1/2} ) \\
    \end{array} 
    \right. \; .
$$</span><br /></p>
<p>Even at sea level, the thermal conductivity is kept constant (depending on <span class="math inline"><em>l</em></span>).</p>
<p><br /><span class="math display"><em>F</em><em>g</em><sub><em>l</em> − 1/2</sub> = <em>K</em><em>s</em><sub><em>l</em> − 1/2</sub>(<em>G</em><sub><em>l</em></sub> − <em>G</em><sub><em>l</em> − 1</sub>)/(<em>z</em><em>s</em><sub><em>l</em></sub> − <em>z</em><em>s</em><sub><em>l</em> − 1</sub>) ,</span><br /></p>
<p><br /><span class="math display">$$
  \frac{\partial Fg_{l-1/2}}{\partial G_l} = - \frac{\partial Fg_{l-1/2}}{\partial G_l-1} 
 = Ks_{l-1/2}/(zs_l - zs_{l-1}) \; .
$$</span><br /></p>
<p>However, in areas where there is sea ice, The temperature of the boundary between sea ice and seawater is set to <span class="math inline"><em>T</em><sub><em>i</em></sub></span> (<span class="math inline">=</span> 271.15K), Let the thermal conductivity be the value of the sea ice.</p>
<p><br /><span class="math display">$$
  Fg_{l-1/2}  = \left\{ 
    \begin{array}{ll}
      Ks_{l-1/2} (G_l - G_{l-1})/(zs_l - zs_{l-1}) \;\; 
               (h_i &lt; zg_{l-3/2} ) \\
      Ks_{l-1/2} (G_l - T_i)/(zs_l - h_i) \;\; 
               ( zg_{l-3/2} \le h_i &lt; zg_{l-1/2} )\\
      K_i (T_i - G_{l-1})/(h_i - zs_{l-1}) \;\; 
               ( zg_{l-1/2} \le h_i &lt; zg_{l+1/2} )\\
      K_i (G_l - G_{l-1})(zs_l - zs_{l-1}) \;\; 
               (h_i \ge zg_{l+1/2} )
    \end{array} 
    \right. \; .
$$</span><br /></p>
<p>Heat fluxes in the oceans outside the sea ice area are significant because This is only the case with the oceanic mixed layer model.</p>
<h3 id="evaluating-surface-wetness-at-sea-level-moduleseabet">Evaluating surface wetness at sea level <code>MODULE:[SEABET]</code></h3>
<p>The surface moisture content of the <span class="math inline"><em>β</em></span> used to evaluate evaporation is , The constant value of 1 for the sea surface and sea ice.</p>
<h3 id="albedo-and-roughness-at-sea-level">albedo and roughness at sea level</h3>
<p>The albedo at the sea surface, which is not covered by sea ice, is in the radiation routine, Calculated at each wavelength as a function of atmospheric optical thickness and solar incidence angle <code>MODULE:[SSRFC]</code> .</p>
<p>The roughness of the ocean surface that is not covered by the ocean is determined in the surface flux routine, Calculated as a function of momentum flux <code>MODULE:[SEAZ0F]</code> .</p>
<p>The albedo and roughness of the sea surface covered with sea ice are Give a constant value. <code>MODULE:[SEAALB, SEAZ0]</code>. The current standard value is 0.7, albedo, The roughness is 1 <span class="math inline"> × 10<sup> − 3</sup></span> m.</p>
<p>In the following, we describe the different treatment of the snow surface from that of the land surface.</p>
<h3 id="snow-heat-flux-correction-modulesnwflx">Snow Heat Flux Correction <code>MODULE:[SNWFLX]</code></h3>
<p>The snow is treated thermally as the same layer as the first layer of the ground surface. That is, the heat capacity and thermal diffusivity of the first layer are The shape will be changed by the presence of snow.</p>
<p>The heat capacity is expressed as a simple sum of <span class="math inline"><em>C</em><sub><em>y</em></sub></span> as the specific heat per mass of snow, <span class="math inline"><em>W</em><sub><em>y</em></sub></span> as the mass per unit area of snow So,</p>
<p><br /><span class="math display"><em>C</em><em>g</em><sub><em>l</em></sub> = <em>C</em><em>g</em>′<sub><em>l</em></sub> + <em>C</em><sub><em>y</em></sub><em>W</em><sub><em>y</em></sub> .</span><br /></p>
<p>However, <span class="math inline"><em>C</em><em>g</em>′<sub><em>l</em></sub></span> is the heat capacity in the absence of snow.</p>
<p>The heat flux is defined as the hypothetical temperature at the snow-soil interface, which is set to <span class="math inline"><em>G</em><sub><em>I</em></sub></span>,</p>
<p><br /><span class="math display"><em>F</em><em>g</em><sub>1/2</sub> = <em>K</em><sub><em>y</em></sub>(<em>G</em><sub><em>I</em></sub> − <em>T</em><sub>0</sub>)/<em>h</em><sub><em>y</em></sub> = <em>K</em><em>g</em><sub>1/2</sub>(<em>G</em><sub>1</sub> − <em>G</em><sub><em>I</em></sub>)(<em>z</em><em>g</em><sub>1</sub> − <em>z</em><em>g</em><sub>0</sub>) .</span><br /></p>
<p>However, the depth of the snow cover in <span class="math inline"><em>h</em><sub><em>y</em></sub></span> is Let <span class="math inline"><em>ρ</em><sub><em>y</em></sub></span> be the density of snow, and <span class="math inline"><em>h</em><sub><em>y</em></sub> = <em>W</em><sub><em>y</em></sub>/<em>ρ</em><sub><em>y</em></sub></span> be the density of snow. Eliminating <span class="math inline"><em>G</em><sub><em>I</em></sub></span> from the equation above,</p>
<p><br /><span class="math display">$$
  Fg_{1/2}  = \left[ \left( K_y/h_y \right)^{-1} 
                   +  \left( K_g /(zg_1 - zg_0) \right)^{-1} 
              \right]^{-1} (G_1-T_0)
                    \\
            = \left[ \left( K_y (G_1-T_0)/h_y \right)^{-1} 
                    +  (Fg_{1/2})^{-1}
                \right]^{-1} \; .
$$</span><br /></p>
<p>However, the <span class="math inline"><em>F</em><em>g</em>′<sub>1/2</sub></span> is the flux when there is no snow. Therefore, if this has already been calculated, By taking the harmonic mean of that and the snow only flux, Fluxes are required in the presence of snow. Also, the temperature differential coefficient of the fluxes <span class="math inline">$\frac{\partial Fg_{1/2}}{\partial G_1}$</span> and <span class="math inline">$\frac{\partial Fg_{1/2}}{\partial T_0}$</span> is similarly obtained by the harmonic mean of the temperature differential coefficients.</p>
<p>If there is more than a certain amount of snowfall , The temperature <span class="math inline"><em>G</em><sub>1</sub></span> should be regarded as the temperature of the snowpack rather than the temperature of the soil. To account for such cases, in fact, the In the above formula, instead of <span class="math inline"><em>h</em><sub><em>y</em></sub></span>, <span class="math inline"><em>h</em><sub><em>y</em></sub>/2</span> is used, Furthermore, not only <span class="math inline"><em>F</em><sub>1/2</sub></span>, but also <span class="math inline"><em>F</em><sub>3/2</sub></span> is changed by snow Handling.</p>
<p><br /><span class="math display"><em>F</em><em>g</em><sub>1/2</sub> = [(<em>K</em><sub><em>y</em></sub>(<em>G</em><sub>1</sub>−<em>T</em><sub>0</sub>)/(<em>h</em><sub><em>y</em></sub>/2))<sup> − 1</sup>+(<em>F</em><em>g</em>′<sub>1/2</sub>)<sup> − 1</sup>]<sup> − 1</sup> ,</span><br /></p>
<p><br /><span class="math display"><em>F</em><em>g</em><sub>3/2</sub> = [(<em>K</em><sub><em>y</em></sub>(<em>G</em><sub>2</sub>−<em>G</em><sub>1</sub>)/(<em>h</em><sub><em>y</em></sub>/2))<sup> − 1</sup>+(<em>F</em><em>g</em>′<sub>3/2</sub>)<sup> − 1</sup>]<sup> − 1</sup> .</span><br /></p>
<h3 id="calculating-snow-sublimation-modulesnwsub">Calculating snow sublimation <code>MODULE:[SNWSUB]</code></h3>
<p>Decrease the snowpack by the amount of sublimation flux.</p>
<p><br /><span class="math display">$$
  \tilde{Wy} = Wy - Fq_1 \Delta t \; .
$$</span><br /></p>
<p>When the snowfall is fully sublimated, the missing water flux is evaporated from the soil. The energy balance of the earth’s surface is assumed to be the same as if the surface moisture flux were all sublimated We need to correct for the soil temperature because it has been calculated.</p>
<p><br /><span class="math display"><em>G̃</em><sub>1</sub> = <em>G</em><sub>1</sub> + <em>L</em><sub><em>M</em></sub>(<em>F</em><em>q</em><sub>1</sub><em>Δ</em><em>t</em> − <em>W</em><em>y</em>)/<em>C</em><em>g</em><sub>1</sub> .</span><br /></p>
<h3 id="calculating-snowfall-modulesnwflp">Calculating snowfall <code>MODULE:[SNWFLP]</code></h3>
<p>When precipitation arrives at the ground surface, it is judged whether it is solid (snow) or liquid (rain).</p>
<p>Atmosphere First Layer Wet Bulb Temperature <span class="math inline"><em>T</em><em>w</em><sub>1</sub></span></p>
<p><br /><span class="math display">$$
Tw_1 = T_1 - L / Cp ( q^* - q_1 ) / ( 1 + L / Cp \frac{\partial q^*}{\partial T} )
$$</span><br /></p>
<p>and if the <span class="math inline"><em>T</em><em>w</em><sub>1</sub></span> is lower than the freezing point <span class="math inline"><em>T</em><em>m</em></span>, snow, TERM If it’s over 00101, it shall be considered rain. The reason why the wet-ball temperature is used is that the temperature of precipitation reaching the surface is This is to incorporate effects that depend on the likelihood of evaporation during the fall of precipitation.</p>
<p>In the case of snowfall, the snowpack is increased by the amount of snowfall.</p>
<p><br /><span class="math display">$$
\tilde{Wy} = Wy + Py \Delta t \; .
$$</span><br /></p>
<p><span class="math inline"><em>P</em><em>y</em></span> is a snowfall flux.</p>
<h3 id="snowmelt-calculation-modulesnwmlp">Snowmelt calculation <code>MODULE:[SNWMLP]</code></h3>
<p>If the surface energy balance (<span class="math inline"><em>Δ</em><em>s</em></span>) is positive, as a result of the calculation of the surface energy balance and/or Soil first layer in areas with snow cover (including snowpack) When the temperature of the soil is higher than the freezing point, the amount of snowmelt is calculated and the latent heat of melting is calculated. Make corrections.</p>
<p>If the soil temperature before correction is set to <span class="math inline">$\hat{G_1}$</span>, If the snowmelt occurred to the extent that it would resolve the energy balance Snowmelt <span class="math inline">$\tilde{My} \Delta t$</span> and soil temperature <span class="math inline">$\tilde{G_1}$</span> are ,</p>
<p>When the <span class="math inline">$\hat{G_1} \ge Tm$</span> ,</p>
<p><br /><span class="math display">$$
\tilde{My} \Delta t = ( Cg_1 ( \hat{G_1} - Tm ) + \Delta s \Delta t ) / L_M \; ,
$$</span><br /></p>
<p><br /><span class="math display">$$
\tilde{G_1} = Tm \, .
$$</span><br /></p>
<p>When the <span class="math inline">$\hat{G_1} &lt; Tm$</span> ,</p>
<p><br /><span class="math display">$$
\tilde{My} \Delta t = \Delta s \Delta t / ( L_M + Cp_I ( Tm - \hat{G_1} ) ) \; ,
$$</span><br /></p>
<p><br /><span class="math display">$$
\tilde{G_1} = \hat{G_1} \; .
$$</span><br /></p>
<p>In the case of <span class="math inline">$\hat{G_1} &lt; Tm$</span>, the temperature of the part of the snow that melts in the energy balance except for the snow is I’m assuming it doesn’t change. <span class="math inline"><em>L</em><sub><em>M</em></sub></span> is the latent heat of melting, <span class="math inline"><em>T</em><em>m</em></span> is the freezing point, <span class="math inline"><em>C</em><em>p</em><sub><em>I</em></sub></span> is the specific heat of ice It is.</p>
<p>The actual snowmelt and soil temperature are based on the current amount of snow and soil temperature in the case of full melting of the <span class="math inline"><em>W</em><em>y</em></span>,</p>
<p><br /><span class="math display">$$
My \Delta t = \left\{
   \begin{array}{ll}
      \tilde{My} \Delta t  ( \tilde{My} \Delta t \le Wy ) \\
      Wy                   ( \tilde{My} \Delta t &gt;   Wy ) \\
   \end{array}
\right. \; ,
$$</span><br /></p>
<p><br /><span class="math display">$$
G_1 = \left\{
   \begin{array}{ll}
      \tilde{G_1}   ( \tilde{My} \Delta t \le Wy ) \\
      \hat{G_1} + ( \Delta s \Delta t - L_M Wy - Cp_I Wy ( Tm - \hat{G_1} ) )
                / ( Cg_1 - Cp_I Wy )
                    ( \tilde{My} \Delta t &gt;   Wy ) \\
   \end{array}
\right. \; .
$$</span><br /></p>
<h3 id="calculating-snow-surface-runoffmodulesnwrof">Calculating Snow Surface Runoff<code>MODULE:[SNWROF]</code></h3>
<p>If there is a snow <span class="math inline"><em>W</em><em>y</em></span>, prior to calculating the land surface runoff The runoff due to snow accumulation was evaluated as follows, Exclude moisture from the surface input. Snowmelt water (<span class="math inline"><em>M</em><em>y</em></span>) is added to the surface water input here.</p>
<p><br /><span class="math display">$$
  Is = \left\{
    \begin{array}{ll}
      1 - Wy / Wy_{Ci}  \;\; ( Wy &lt; Wy_{Ci} ) \\
      0                 \;\; ( Wy \ge Wy_{Ci} )
    \end{array}
  \right. \; ,
$$</span><br /></p>
<p><br /><span class="math display">$$
  \widetilde{P_c} = Is P_c \; ,\\
  \widetilde{P_l} = Is ( P_c + My ) \; ,\\
  R_S        = ( 1 - Is )( P_c + P_l + My ) \; .
$$</span><br /></p>
<p>where <span class="math inline"><em>I</em><em>s</em></span> is the surface infiltration rate due to snow cover. The standard value of critical snowpack for infiltration for <span class="math inline"><em>W</em><em>y</em><sub><em>C</em><em>i</em></sub></span> is 200 kg/m<span class="math inline"><em></em><sup>2</sup></span> .</p>
<h3 id="evaluating-albedo-on-snow-covered-surfacesmodulesnwalb">Evaluating albedo on snow-covered surfaces<code>MODULE:[SNWALB]</code></h3>
<p>If you have a snow <span class="math inline"><em>W</em><em>y</em></span> , The ratio of snow cover is considered to be proportional to the square root of the snowpack, Albedo approaches the snow value <span class="math inline"><em>α</em><em>s</em></span> in proportion to the square root of the snowpack (The critical value of <span class="math inline"><em>W</em><em>y</em><sub><em>C</em></sub></span> is 200 kg/m<span class="math inline"><em></em><sup>2</sup></span> in standard).</p>
<p><br /><span class="math display">$$
  \alpha = \left\{ 
  \begin{array}{ll}
    \alpha' + (\alpha s-\alpha')\sqrt{Wy/Wy_{C}} \;\;   (Wy &lt; Wy_{C}) \\
    \alpha s                                            (Wy \ge Wy_{C})
  \end{array}
  \right. \; .
$$</span><br /></p>
<p>Also, when melting occurs and the snowpack is wet, the snow albedo The smaller effect is considered as follows.</p>
<p><br /><span class="math display">$$
  \alpha s = \left\{
    \begin{array}{ll}
      \alpha s_d                         \;\; (T_0 \le Td) \\
      \alpha s_d - (\alpha s_m -\alpha s_d)
                   (T_0 - Td)/(Td - Tm)  \;\; (Td &lt; T_0 \le Tm) \\
      \alpha s_m                         \;\; (T_0 &gt; Tm)
    \end{array}
  \right. \; .
$$</span><br /></p>
<p>where <span class="math inline"><em>T</em><sub>0</sub></span> is the surface temperature. Dry Snow Albedo <span class="math inline"><em>α</em><em>s</em><sub><em>d</em></sub></span>, Wet Snow Albedo <span class="math inline"><em>α</em><em>s</em><sub><em>m</em></sub></span> The standard values for Critical temperature (<span class="math inline"><em>T</em><em>d</em></span> and <span class="math inline"><em>T</em><em>m</em></span>) was 258.15 and 273.15, respectively Yes.</p>
<p>Furthermore, as in the absence of snow, we can take into account the effect of the zenith angle dependence of solar radiation (Not considered in the standard).</p>
<h3 id="evaluating-surface-roughness-on-snow-covered-surfacesmodulesnwz0">Evaluating Surface Roughness on Snow Covered Surfaces<code>MODULE:[SNWZ0]</code></h3>
<p>If you have a snow <span class="math inline"><em>W</em><em>y</em></span> , The ratio of snow cover is considered to be proportional to the square root of the snowpack, Surface roughness approaches snow roughness in proportion to the square root of the snowpack. (The critical value, <span class="math inline"><em>W</em><em>y</em><sub><em>C</em></sub></span>, is 200 kg/m<span class="math inline"><em></em><sup>2</sup></span> in standard).</p>
<p><br /><span class="math display">$$
  z_0 = \left\{ 
  \begin{array}{ll}
    z_0' + (z_0s-z_0')\sqrt{Wy/Wy_{C}}  \;\;   (Wy &lt; Wy_{C}) \\
    z_0s                                       (Wy \ge Wy_{C})
  \end{array}
  \right. \; .
$$</span><br /></p>
<p>The standard values for snow roughness are for momentum, temperature and water vapor, respectively. 10 <span class="math inline"><em></em><sup> − 2</sup></span>, 10 <span class="math inline"><em></em><sup> − 3</sup></span>, 10 <span class="math inline"><em></em><sup> − 3</sup></span>.</p>
<h3 id="evaluating-surface-wetness-on-snow-covered-surfacesmodulesnwbet">Evaluating Surface Wetness on Snow Covered Surfaces<code>MODULE:[SNWBET]</code></h3>
<p>If you have a snow <span class="math inline"><em>W</em><em>y</em></span> , The ratio of snow cover is considered to be proportional to the square root of the snowpack, Surface wetness approaches snow wetness 1 in proportion to the square root of the snowpack (The critical value of <span class="math inline"><em>W</em><em>y</em><sub><em>C</em></sub></span> is 200 kg/m<span class="math inline"><em></em><sup>2</sup></span> in standard).</p>
<p><br /><span class="math display">$$
  \beta = \left\{ 
  \begin{array}{ll}
    \beta' + (1-\beta')\sqrt{Wy/Wy_{C}}  \;\;   (Wy &lt; Wy_{C}) \\
    1                                           (Wy \ge Wy_{C})
  \end{array}
  \right. \; .
$$</span><br /></p>
<p>In the following section, we describe the optional surface processes.</p>
<h3 id="calculating-the-freezing-process-modulelndfrz">Calculating the freezing process <code>MODULE:[LNDFRZ]</code></h3>
<p>To use this option, you must use the The number of vertical layers in the ground and the level of each layer must be equal.</p>
<p>After calculating the ground temperature by thermal diffusion,</p>
<ul>
<li><p>If the ground temperature is lower than the freezing point and liquid moisture is present, the freezing of moisture will be</p></li>
<li><p>If the ground temperature is higher than the freezing point and solid moisture is present, the water will melt.</p></li>
</ul>
<p>Calculate.</p>
<p>If the icing ratio of the <span class="math inline"><em>l</em></span> layer is set to <span class="math inline"><em>w</em><sub><em>F</em><em>l</em></sub></span>, the freezing water in the <span class="math inline"><em>Δ</em><em>w</em><sub><em>F</em><em>l</em></sub></span> is,</p>
<p><br /><span class="math display">$$
  \Delta w_{Fl} = \left\{
    \begin{array}{ll}
      - w_{Fl}
         \;\; ( \Delta_0 w_{Fl} \le - w_{Fl} ) \\
      \Delta_0 w_{Fl}
         \;\; ( - w_{Fl} &lt; \Delta_0 w_{Fl} \le w_l - w_{Fl} ) \\
      w_l - w_{Fl}
         \;\; ( \Delta_0 w_{Fl} &gt;  w_{Fl} )
    \end{array}
  \right. \; .
$$</span><br /></p>
<p>where the negative <span class="math inline"><em>Δ</em><em>w</em><sub><em>F</em><em>l</em></sub></span> represents the water to be melted. The <span class="math inline"><em>Δ</em><sub>0</sub><em>w</em><sub><em>F</em><em>l</em></sub></span> will freeze/thaw until the soil temperature reaches the freezing point. This is the value of <span class="math inline"><em>Δ</em><em>w</em><sub><em>F</em><em>l</em></sub></span> if it were to occur, given by</p>
<p><br /><span class="math display"><em>Δ</em><sub>0</sub><em>w</em><sub><em>F</em><em>l</em></sub> = <em>C</em><em>g</em><sub><em>l</em></sub>(<em>T</em><em>m</em> − <em>G</em><sub><em>l</em></sub>)/(<em>L</em><sub><em>M</em></sub><em>C</em><em>w</em><sub><em>l</em></sub>) .</span><br /></p>
<p><span class="math inline"><em>T</em><em>m</em></span> has an ice point of 273.16K.</p>
<p>The change in soil temperature due to the latent heat of the soil moisture phase change is given by</p>
<p><br /><span class="math display"><em>G̃</em><sub><em>l</em></sub> = <em>G</em><sub><em>l</em></sub> + <em>L</em><sub><em>M</em></sub><em>C</em><em>w</em><sub><em>l</em></sub><em>Δ</em><em>w</em><sub><em>F</em><em>l</em></sub>/<em>C</em><em>g</em><sub><em>l</em></sub> .</span><br /></p>
<h3 id="oceanic-mixed-layer-model-moduleseafrz">oceanic mixed layer model <code>MODULE:[SEAFRZ]</code></h3>
<p>In the oceanic mixed layer model , By solving for the heat balance of the oceans, the temperature of the oceans and Determine the time variation of sea ice thickness.</p>
<p>Multi-layered models are possible, but, Here we will take a single layer model of thickness <span class="math inline"><em>D</em></span> as an example. The predictor variables are temperature (<span class="math inline"><em>G</em></span>) and sea ice thickness (<span class="math inline"><em>h</em><sub><em>I</em></sub></span>).</p>
<p>First, determine the heat capacity and surface flux of the ocean. <code>MODULE:[SEAFLX]</code> The heat capacity of the oceans is , Specific Heat of Water <span class="math inline"><em>C</em><sub><em>w</em></sub></span>, Specific Heat of Ice <span class="math inline"><em>C</em><sub><em>I</em></sub></span>, Density of Water and Ice <span class="math inline"><em>ρ</em><sub><em>w</em></sub></span> as ,</p>
<p><br /><span class="math display"><em>C</em><sub><em>s</em></sub> = <em>C</em><sub><em>I</em></sub><em>ρ</em><sub><em>w</em></sub><em>h</em><sub><em>I</em></sub> + <em>C</em><sub><em>w</em></sub><em>ρ</em><sub><em>w</em></sub>(<em>D</em> − <em>h</em><sub><em>I</em></sub>)</span><br /></p>
<p>In the absence of sea ice, the heat transfer flux is</p>
<p><br /><span class="math display">$$
  Fs_{1/2} = K_s \frac{ G - T_0 }{d/2}
$$</span><br /></p>
<p>On the other hand, if there is sea ice,</p>
<p><br /><span class="math display">$$
 Fs_{1/2} = K_I \frac{ T_I - T_0 }{h_I}
$$</span><br /></p>
<p>where <span class="math inline"><em>T</em><sub><em>I</em></sub></span> is the freezing temperature of sea ice at 271.35 K. where <span class="math inline"><em>T</em><sub><em>I</em></sub></span> is the freezing temperature of sea ice at 271.35 K.</p>
<p>Heat flux in the <span class="math inline"><em>z</em> = <em>D</em></span> is usually zero while the <span class="math inline"><em>F</em><em>s</em><sub>1 + 1/2</sub></span> is usually zero, It can be given from the outside. It is used in the case of flux correction for oceanic heat transport.</p>
<ol start="2" type="1">
<li>using this heat flux and heat capacity As with the land surface, determine the change in temperature (<span class="math inline"><em>G</em></span>).</li>
</ol>
<p>The melting of the sea ice surface is treated in the same way as snow. <code>MODULE:[SEAFLX]</code></p>
<p>First, I’ll set the melting value, <span class="math inline">$\tilde{M_I}$</span>, to When the <span class="math inline"><em>G</em> ≥ <em>T</em><sub><em>I</em></sub></span> ,</p>
<p><br /><span class="math display">$$
  M_I
  =  \frac{C_s ( G - T_I ) + \Delta s \Delta t )}
          {\rho_w ( C_w - C_I ) T_I }
$$</span><br /></p>
<p>When the <span class="math inline"><em>G</em> &lt; <em>T</em><sub><em>I</em></sub></span> ,</p>
<p><br /><span class="math display">$$
  M_I
  =  \frac{\Delta s \Delta t )}
          {\rho_w ( C_w - C_I ) G}
$$</span><br /></p>
<p>Estimate in , However, if it has melted completely, set the value to <span class="math inline"><em>M</em><sub><em>I</em></sub> = <em>h</em><sub><em>I</em></sub></span> and compensate for the heat.</p>
<p><br /><span class="math display">$$
  G \leftarrow G + \frac{ \Delta s \Delta t 
                          - \rho_w ( C_w - C_I ) h_I G  }
                        { C_w + \rho_w ( C_w - C_I ) h_I}
$$</span><br /></p>
<p>Varying the thickness of the ice,</p>
<p><br /><span class="math display"><em>h</em><sub><em>I</em></sub> ← <em>h</em><sub><em>I</em></sub> − <em>M</em><sub><em>I</em></sub></span><br /></p>
<p>Then, vary the heat capacity correspondingly.</p>
<p><br /><span class="math display"><em>C</em><sub><em>s</em></sub> = <em>C</em><sub><em>s</em></sub> + <em>ρ</em><sub><em>w</em></sub>(<em>C</em><sub><em>w</em></sub> − <em>C</em><sub><em>I</em></sub>)<em>h</em><sub><em>I</em></sub></span><br /></p>
<p>The next step is to consider the growth process from the bottom of the sea ice.</p>
<pre><code> 1. when there is no sea ice ($h_I=0$)</code></pre>
<p>When the <span class="math inline"><em>G</em> &lt; <em>T</em><sub><em>I</em></sub></span> ,</p>
<p><br /><span class="math display">$$
  \tilde{f_I}
  =  \frac{C_s ( T_I - G ) - \Delta s \Delta t )}
          {\rho_w ( C_w - C_I ) T_I }
$$</span><br /></p>
<p>When the <span class="math inline"><em>G</em> ≥ <em>T</em><sub><em>I</em></sub></span> ,</p>
<p><br /><span class="math display">$$
  \tilde{f_I}
  =  \frac{- \Delta s \Delta t )}
          {\rho_w ( C_w - C_I ) G}
$$</span><br /></p>
<p>Estimate in . When it is positive, sea ice is produced. Here, <span class="math inline"><em>Δ</em><em>s</em></span> is <span class="math inline"><em>T</em><sub>0</sub></span> is <span class="math inline"><em>T</em><sub><em>I</em></sub> = 271.35</span> K or less Note that it is positive when the</p>
<p><br /><span class="math display">$$
  h_I  \leftarrow  f_I \\
  C_s  \leftarrow  C_s - \rho_w ( C_w - C_I ) f_I \\
  G    \leftarrow  \max( G, T_I )
$$</span><br /></p>
<pre><code> 2. when the sea ice is already present ($h_I&gt;0$)</code></pre>
<p>Heat fluxes from the seawater beneath the sea ice to the bottom of the sea ice.</p>
<p><br /><span class="math display">$$
  F_b = K_s \frac{ G - T_I }{ D/2 - h_I }
$$</span><br /></p>
<p>Estimate in . The difference between <span class="math inline"><em>F</em><sub><em>b</em></sub></span> and the heat flux from the ocean to the top of <span class="math inline"><em>F</em><em>s</em><sub>1/2</sub></span> Used for the growth or melting of sea ice.</p>
<p><br /><span class="math display">$$
  f_I = \frac{ Fs_{1/2} - F_b }
             { \rho_w ( C_w - C_I ) G } \Delta t
$$</span><br /></p>
<p>So..,</p>
<p><br /><span class="math display">$$
  h_I  \leftarrow  h_I + f_I \\
  G    \leftarrow  G \frac{C_s}{C_s - \rho_w ( C_w - C_I ) f_I} \\
  C_s  \leftarrow  C_s - \rho_w ( C_w - C_I ) f_I
$$</span><br /></p>
<ol start="5" type="1">
<li>give an external reference temperature of <span class="math inline"><em>G</em><sub><em>r</em><em>e</em><em>f</em></sub></span> You can nudging it.</li>
</ol>
<p><br /><span class="math display">$$
        G \leftarrow G + \frac{G_{ref} - G}{\tau} \Delta t
$$</span><br /></p>
<p>This is a heat flux</p>
<p><br /><span class="math display">$$
        F_n = C_s \frac{G_{ref} - G}{\tau}
$$</span><br /></p>
<p>The equivalent of giving a .</p>
<pre><code> To do flux correction,</code></pre>
<p>Provide the appropriate <span class="math inline"><em>τ</em></span> and perform nudging, Remember the <span class="math inline"><em>F</em><sub><em>n</em></sub></span>, You can give it to me as <span class="math inline"><em>F</em><em>s</em><sub>1 + 1/2</sub></span>.</p>
</body>
</html>
