
## モデルグリッドとカップラーの基本的な構成

MIROCの大気モデルと海洋モデルは独立しており、異なる計算ノードで実行される。ここでは大気モデルが実行されるノードを大気ノード、海洋モデルが実行されるノードを海洋ノードと呼ぶ。大気ノード内ではサブモデルとして陸面モデル、海面モデル、河川モデルが実行される。大気海洋間の情報交換は大気ノードの海面モデルを通じて行われる．海洋ノード内の海洋モデルの海面水温、海氷密接度などの情報は、大気ノード内でモデルの境界条件として扱えるように海面モデルのグリッドに変換される。一方、大気ノードの海面海面モデルのグリッドで計算された熱・淡水・運動量フラックスは海洋モデルのグリッドに変換され、海洋ノードに送られる。これらの一連のデータ通信、変換はエクスチェンジャーで行われる。
フラックスカップラーは境界条件や海面モデルや陸面モデルで計算した熱・淡水フラックスなどのデータを格納し必要に応じて、各モデルに振り分けている。一般にフラックスカップラーはエクスチェンジャ―の機能も含むがここでは区別して記述する。

## モデルの水平グリッド

気候モデルMIROCの水平グリッドは大気ノード内の各モデルにおいて、大気グリッド、陸面グリッド、河川グリッド、海面グリッドとして定義される．大気ノード内の海面グリッドは海洋ノード内の海洋モデルの水平グリッドとは異なる。陸面グリッドおよび海面グリッドは大気モデルの水平グリッドを南北方向・東西方向に等分割したものであり、分割個数はそれぞれのグリッドで任意に設定可能である。
ただし海面グリッドの分割個数は陸面モデルの分割個数で割り切れる必要がある。
また、河川グリッドは大気グリッドと同じものもしくは等緯度経度間隔グリッドが使用可能である。海洋モデルの水平グリッドは水平一般曲線直交座標を採用しており、大気モデルと同じ座標系を扱う必要はない。
大気モデルと海洋モデルのデータの交換はあらかじめ大気モデルの海面グリッドと重複する海洋グリッドの場所、数、面積、ベクトルの回転などの情報を用意しておき、エクスチェンジャーにより行われる。

## 海陸分布の定義

気候モデルMIROC内の海陸分布は海洋モデルによって定義された海陸分布が優先される。海洋モデルの1グリッドは陸または海だけで定義されているが、大気モデルの陸面グリッド、海洋面グリッドは海洋モデルの海陸分布と整合がとれるように陸と海の割合が決定される。

$SA$ を大気グリッドの面積、$SL_{ij}$ を陸面のグリッドの面積、$SO_{ij}$ を海面グリッドの面積、$FLND^{atm}$,$FLND^{land}_{ij}$,$FLND^{oc}_{ij}$をそれぞれのグリッドに陸面の占める割合とすると次式を満たす。

$$ SA*FLND^{atm} = \sum_{j=1}^{jldiv}\sum_{i=1}^{ildiv}(SL_{ij}*FLND^{land}_{ij}) = \sum_{j=1}^{jodiv}\sum_{i=1}^{iodiv}(SO_{ij}*FLND^{oc}_{ij}) $$

ここで、(ildiv,jldiv)は陸面グリッドの東西・南北分割個数、(iodiv,jodiv)は海面グリッドの東西・南北方向の分割個数である。陸面グリッドにおいて、少しでも陸が存在すると定義された場合、陸面被覆などの境界値が必要となる。

## 大気モデルへのフラックス

### 大気海洋間のフラックス
海面から大気へのフラックス（FLXO）は大気モデルの海面グリッドで計算する．境界条件としての海面水温，海氷密接度，海氷厚さ，海氷上の積雪深，海氷内部温度，海洋表層流速は海洋モデルからエクスチェンジャーを通して取得する（海氷面温度は海氷内部温度と海氷の厚さおよび海氷上の大気の状態から決定される．現在のところMIROCでは海氷速度はフラックス計算には用いていない）．大気の境界条件としての海上での風速，気温，比湿等は大気のグリッドから，線形もしくは3次スプライン補完を用いて，海面のグリッドに変換する．海面からのフラックスは海水面と海氷面でそれぞれ別々に計算され，面積の重みで平均し大気に渡される．（海氷厚さでカテゴリー分けされた海氷モデルを使用する場合はそれぞれの海氷厚のカテゴリーでフラックスを計算する必要があるかも知れないが，現在のモデルの仕様では平均の海氷厚さでフラックスを計算している．）エクスチェンジャーによる大気海洋間のフラックス，境界条件の変換に関しては後で詳しく記述する．

### 大気陸面間のフラックス
陸面から大気へのフラックス（$FLXL$）は陸面グリッドで計算する。1つの陸面グリッドは複数の土壌被覆と湖から構成される。湖の凍結・融解および積雪は鉛直1時限の氷モデル（0-layer model）によって考慮されている。ここで陸面グリッドの面積を$SL$とすると湖とそれぞれの土壌被覆の占める面積はそれぞれ
$$ SL^{lake}=SL * LKFRC * FLND $$
$$ SL^{grd}_k = SL * GRFRC_k * (1-LKFRC) * FLND$$
となる。ここで$LKFRC$は陸に占める湖の割合、$k$は土壌被覆の種類、$GRFRC_k$は湖を除く陸に占める土壌被覆$k$の割合で示す。陸面からのフラックスはこれらの土壌被覆、湖の上でそれぞれ別々に計算され、面積の重さで平均し、大気に渡される。
$$ FLXL=LKFRC*FLXL^{lake}+(1-LKFRC)*\sum_{k=1}^{km}(GRFRC_k * FLXL_k^{grd}) $$
ここで、$FLXL^{lake}$ は湖面でのフラックス、$FLXL_{k}^{grd}$ は土壌被覆$k$でのフラックス、$km$ は土壌被覆の種類の数。

### 大気へのフラックスの合計
河川モデルは面積を持たないので、大気へのフラックス（$FLXA$）は、陸面グリッドのフラックス（$FLXL$）・海面グリッドでのフラックス（$FLXO$）の海陸分布の重み付き平均として次式のように求める。

$$ FLXA = \frac{1}{SA}* \left[ \sum_{j=1}^{jldiv}\sum_{i=1}^{ildiv}(SL_{ij}*FLND_{ij}^{land}*FLXL_{ij})+\sum_{j=1}^{jodiv}\sum_{i=1}^{iodiv}(SO_{ij} * (1-FLND_{ij}^{oc})*FLXO_{ij}) \right] $$
